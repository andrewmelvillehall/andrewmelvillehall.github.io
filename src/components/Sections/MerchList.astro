---
import { getCollection } from "astro:content";
import Card from "../UI/Card.astro";
import Button from "../UI/Button.astro";

export interface Props {
  showAll?: boolean;
  limit?: number;
  bgGray?: boolean;
}

const { showAll = true, limit = 6, bgGray = false } = Astro.props;

// Get all merch
const allMerch = await getCollection("shop", ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

// Sort by date (newest first)
const merch = allMerch
  .sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
  )
  .slice(0, showAll ? undefined : limit);
---

<section class=`py-16 ${bgGray? "":"bg-white"}`>
  <div class="container">
    <div class="text-center mb-12">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">Current Merch</h2>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto">
        Have a browse of our current merch
      </p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {
        merch.map((item) => (
          <Card
            title={item.data.name}
            image={{
              src: item.data.thumb,
              alt: item.data.name,
            }}
            href={`/shop/${item.slug}`}
            className="merch-card"
            data-date={item.data.date.toISOString().slice(0, 10)}
          >
            <p class="text-xl font-semibold text-gray-700">
              £{item.data.price.toFixed(2)}
            </p>
            <p class="text-gray-700 mb-4">{item.data.summary}</p>

            <p class="text-primary-600 font-medium group-hover:underline group-hover:text-primary-700">
              Learn More →
            </p>
          </Card>
        ))
      }
    </div>

    {
      !showAll && merch.length > 0 && (
        <div class="mt-12 text-center">
          <Button href="/shop" variant="outline">
            View All Merch
          </Button>
        </div>
      )
    }
  </div>
</section>
